dist: trusty
sudo: required

addons:
 ssh_known_hosts:
   - github.com
   - git.coding.net
 apt:
   packages:
     - nasm

env:
 global:
   - TZ=Asia/Tokyo

language: node_js
node_js: node

branches:
 only:
   - master

git:
 depth: false
 submodules: false

cache:
 apt: true
 directories:
   - node_modules

before_install:
 # Git Config
 - git config --global user.name "William Guo"
 - git config --global user.email "dujushi@gmail.com"

 # Restore last modified time
 - "git ls-files -z | while read -d '' path; do touch -d \"$(git log -1 --format=\"@%ct\" \"$path\")\" \"$path\"; done"

 # Deploy history
 - git clone --branch=master --single-branch https://github.com/dujushi/boke .deploy_git

 # SSH Setup
 - openssl aes-256-cbc -K $encrypted_693585a97b8c_key -iv $encrypted_693585a97b8c_iv -in deploy_key.enc -out deploy_key -d
 - eval "$(ssh-agent -s)"
 - chmod 600 ./deploy_key
 - ssh-add ./deploy_key

install: npm install

before_script:

script:
 - hexo clean
 - hexo g -d